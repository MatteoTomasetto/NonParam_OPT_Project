# Sperman's correlation coefficient if the 2 variables are continuous
corr_matrix[i,j] = cor(x[,i], x[,j], method = c("spearman"))
# Alternative: Kendall's correlation coefficient if the 2 variables are continuous
# corr_matrix[i,j] = cor(x[,i], x[,j], method = c("kendall"))
corr_matrix[j,i] = corr_matrix[i,j]
}
if(isfactor[i]==0 & isfactor[j]==1){
# Rank biserial correlation if the 1 variable is continuous and the other is boolean
categ <- levels(x[,j])
idx1 <- which(x[,j]==categ[1])
idx2 <- which(x[,j]==categ[2])
data_ranked <- rank(x[,i])
corr_matrix[i,j] = 2*(mean(data_ranked[idx2])-mean(data_ranked[idx1]))/(dim(x)[1])
corr_matrix[j,i] = corr_matrix[i,j]
}
if(isfactor[i]==1 & isfactor[j]==0){
# Rank biserial correlation if the 1 variable is continuous and the other is binary
categ <- levels(x[,i])
idx1 <- which(x[,i]==categ[1])
idx2 <- which(x[,i]==categ[2])
data_ranked <- rank(x[,j])
corr_matrix[i,j] = 2*(mean(data_ranked[idx2])-mean(data_ranked[idx1]))/(dim(x)[1])
corr_matrix[j,i] = corr_matrix[i,j]
}
if(isfactor[i]==1 & isfactor[j]==1){
# Phi coefficient if the 2 variables are binary
t <- table(x[,i],x[,j])
corr_matrix[i,j] = (t[1,1]*t[2,2]-t[1,2]*t[2,1])/sqrt((t[1,1]+t[1,2])*(t[2,1]+t[2,2])*(t[1,1]+t[2,1])*(t[1,2]+t[2,2]))
corr_matrix[j,i] = corr_matrix[i,j]
}
}
}
}
return(corr_matrix)
}
idx_Var = c(12,13,155,173)
idx_Group = 70
groups = levels(df[,idx_Group])
# discard NA
idx_NA_Var = c()
for (i in 1:length(idx_Var)){
idx_NA_Var = c(idx_NA_Var, which(is.na(df[,idx_Var[i]])))
}
idx_NA_Var = sort(unique(idx_NA_Var))
Var_test = df[-idx_NA_Var,idx_Var]
Group_test = df[-idx_NA_Var,idx_Group]
x = Var_test[which(Group_test==groups[1]),]
y = Var_test[which(Group_test==groups[2]),]
idx_Var = c(12,13,15,155,173)
idx_Group = 70
groups = levels(df[,idx_Group])
# discard NA
idx_NA_Var = c()
for (i in 1:length(idx_Var)){
idx_NA_Var = c(idx_NA_Var, which(is.na(df[,idx_Var[i]])))
}
idx_NA_Var = sort(unique(idx_NA_Var))
Var_test = df[-idx_NA_Var,idx_Var]
Group_test = df[-idx_NA_Var,idx_Group]
x = Var_test[which(Group_test==groups[1]),]
y = Var_test[which(Group_test==groups[2]),]
plot(x[,3],x[,4])
plot(y[,3],y[,4])
corr_matrix_x <- correlation_matrix(x)
corr_matrix_y <- correlation_matrix(y)
corr_matrix_x[3,4]
corr_matrix_7[3,4]
corr_matrix_y[3,4]
image(corr_matrix_x)
image(corr_matrix_y)
plot(y[,1],y[,4])
plot(x[,1],x[,4])
idx_Var = c(12,13,15,40,43,155,173)
idx_Group = 70
groups = levels(df[,idx_Group])
# discard NA
idx_NA_Var = c()
for (i in 1:length(idx_Var)){
idx_NA_Var = c(idx_NA_Var, which(is.na(df[,idx_Var[i]])))
}
idx_NA_Var = sort(unique(idx_NA_Var))
Var_test = df[-idx_NA_Var,idx_Var]
Group_test = df[-idx_NA_Var,idx_Group]
x = Var_test[which(Group_test==groups[1]),]
y = Var_test[which(Group_test==groups[2]),]
# visualize and compute di correlation matrices
corr_matrix_x <- correlation_matrix(x)
corr_matrix_y <- correlation_matrix(y)
norm(corr_matrix_x)
norm(corr_matrix_y)
image(corr_matrix_x)
image(corr_matrix_y)
# test
iter = 1e3
matrix_x_obs <- correlation_matrix(x)
matrix_y_obs <- correlation_matrix(y)
T0 <- sqrt(sum((matrix_x_obs - matrix_y_obs)^2))
# T0 <- 1 - sum(diag(matrix_x_obs*matrix_y_obs))/(norm(matrix_x_obs,"F")*norm(matrix_y_obs,"F"))
x_pooled <- rbind(x,y)
T_stat <- numeric(iter)
n <- dim(x_pooled)[1]
n1 <- dim(x)[1]
for(perm in 1:iter){
# Permutation:
permutation <- sample(1:n)
x_pooled_perm <- x_pooled[permutation,]
x_perm <- x_pooled_perm[1:n1,]
y_perm <- x_pooled_perm[(n1+1):n,]
matrix_x_perm <- correlation_matrix(x_perm)
matrix_y_perm <- correlation_matrix(y_perm)
T_stat[perm] <- sqrt(sum((matrix_x_perm - matrix_y_perm)^2))
# T_stat[perm] <- 1 - sum(diag(matrix_x_perm*matrix_y_perm))/(norm(matrix_x_perm,"F")*norm(matrix_y_perm,"F"))
}
#pvalue
p_val <- sum(na.omit(T_stat)>=T0)/(iter-sum(is.na(T_stat)))
p_val
idx_Var = c(12,13,15,40,43,173)
idx_Group = 70
groups = levels(df[,idx_Group])
# discard NA
idx_NA_Var = c()
for (i in 1:length(idx_Var)){
idx_NA_Var = c(idx_NA_Var, which(is.na(df[,idx_Var[i]])))
}
idx_NA_Var = sort(unique(idx_NA_Var))
Var_test = df[-idx_NA_Var,idx_Var]
Group_test = df[-idx_NA_Var,idx_Group]
x = Var_test[which(Group_test==groups[1]),]
y = Var_test[which(Group_test==groups[2]),]
# visualize and compute di correlation matrices
corr_matrix_x <- correlation_matrix(x)
corr_matrix_y <- correlation_matrix(y)
norm(corr_matrix_x)
norm(corr_matrix_y)
image(corr_matrix_x)
image(corr_matrix_y)
# test
iter = 1e3
matrix_x_obs <- correlation_matrix(x)
matrix_y_obs <- correlation_matrix(y)
T0 <- sqrt(sum((matrix_x_obs - matrix_y_obs)^2))
# T0 <- 1 - sum(diag(matrix_x_obs*matrix_y_obs))/(norm(matrix_x_obs,"F")*norm(matrix_y_obs,"F"))
x_pooled <- rbind(x,y)
T_stat <- numeric(iter)
n <- dim(x_pooled)[1]
n1 <- dim(x)[1]
for(perm in 1:iter){
# Permutation:
permutation <- sample(1:n)
x_pooled_perm <- x_pooled[permutation,]
x_perm <- x_pooled_perm[1:n1,]
y_perm <- x_pooled_perm[(n1+1):n,]
matrix_x_perm <- correlation_matrix(x_perm)
matrix_y_perm <- correlation_matrix(y_perm)
T_stat[perm] <- sqrt(sum((matrix_x_perm - matrix_y_perm)^2))
# T_stat[perm] <- 1 - sum(diag(matrix_x_perm*matrix_y_perm))/(norm(matrix_x_perm,"F")*norm(matrix_y_perm,"F"))
}
#pvalue
p_val <- sum(na.omit(T_stat)>=T0)/(iter-sum(is.na(T_stat)))
p_val
idx_Var = c(12,13,15,155,173)
idx_Group = 70
groups = levels(df[,idx_Group])
# discard NA
idx_NA_Var = c()
for (i in 1:length(idx_Var)){
idx_NA_Var = c(idx_NA_Var, which(is.na(df[,idx_Var[i]])))
}
idx_NA_Var = sort(unique(idx_NA_Var))
Var_test = df[-idx_NA_Var,idx_Var]
Group_test = df[-idx_NA_Var,idx_Group]
x = Var_test[which(Group_test==groups[1]),]
y = Var_test[which(Group_test==groups[2]),]
# visualize and compute di correlation matrices
corr_matrix_x <- correlation_matrix(x)
corr_matrix_y <- correlation_matrix(y)
norm(corr_matrix_x)
norm(corr_matrix_y)
image(corr_matrix_x)
image(corr_matrix_y)
# test
iter = 1e3
matrix_x_obs <- correlation_matrix(x)
matrix_y_obs <- correlation_matrix(y)
T0 <- sqrt(sum((matrix_x_obs - matrix_y_obs)^2))
# T0 <- 1 - sum(diag(matrix_x_obs*matrix_y_obs))/(norm(matrix_x_obs,"F")*norm(matrix_y_obs,"F"))
x_pooled <- rbind(x,y)
T_stat <- numeric(iter)
n <- dim(x_pooled)[1]
n1 <- dim(x)[1]
for(perm in 1:iter){
# Permutation:
permutation <- sample(1:n)
x_pooled_perm <- x_pooled[permutation,]
x_perm <- x_pooled_perm[1:n1,]
y_perm <- x_pooled_perm[(n1+1):n,]
matrix_x_perm <- correlation_matrix(x_perm)
matrix_y_perm <- correlation_matrix(y_perm)
T_stat[perm] <- sqrt(sum((matrix_x_perm - matrix_y_perm)^2))
# T_stat[perm] <- 1 - sum(diag(matrix_x_perm*matrix_y_perm))/(norm(matrix_x_perm,"F")*norm(matrix_y_perm,"F"))
}
#pvalue
p_val <- sum(na.omit(T_stat)>=T0)/(iter-sum(is.na(T_stat)))
p_val
idx_Var = c(12,13,40,43,155,173)
idx_Group = 3
groups = levels(df[,idx_Group])
# discard NA
idx_NA_Var = c()
for (i in 1:length(idx_Var)){
idx_NA_Var = c(idx_NA_Var, which(is.na(df[,idx_Var[i]])))
}
idx_NA_Var = sort(unique(idx_NA_Var))
Var_test = df[-idx_NA_Var,idx_Var]
Group_test = df[-idx_NA_Var,idx_Group]
x = Var_test[which(Group_test==groups[1]),]
y = Var_test[which(Group_test==groups[2]),]
# visualize and compute di correlation matrices
corr_matrix_x <- correlation_matrix(x)
corr_matrix_y <- correlation_matrix(y)
norm(corr_matrix_x)
norm(corr_matrix_y)
image(corr_matrix_x)
image(corr_matrix_y)
# test
iter = 1e3
matrix_x_obs <- correlation_matrix(x)
matrix_y_obs <- correlation_matrix(y)
T0 <- sqrt(sum((matrix_x_obs - matrix_y_obs)^2))
# T0 <- 1 - sum(diag(matrix_x_obs*matrix_y_obs))/(norm(matrix_x_obs,"F")*norm(matrix_y_obs,"F"))
x_pooled <- rbind(x,y)
T_stat <- numeric(iter)
n <- dim(x_pooled)[1]
n1 <- dim(x)[1]
for(perm in 1:iter){
# Permutation:
permutation <- sample(1:n)
x_pooled_perm <- x_pooled[permutation,]
x_perm <- x_pooled_perm[1:n1,]
y_perm <- x_pooled_perm[(n1+1):n,]
matrix_x_perm <- correlation_matrix(x_perm)
matrix_y_perm <- correlation_matrix(y_perm)
T_stat[perm] <- sqrt(sum((matrix_x_perm - matrix_y_perm)^2))
# T_stat[perm] <- 1 - sum(diag(matrix_x_perm*matrix_y_perm))/(norm(matrix_x_perm,"F")*norm(matrix_y_perm,"F"))
}
#pvalue
p_val <- sum(na.omit(T_stat)>=T0)/(iter-sum(is.na(T_stat)))
p_val
idx_Var = c(12,13,40,43,173)
idx_Group = 3
groups = levels(df[,idx_Group])
# discard NA
idx_NA_Var = c()
for (i in 1:length(idx_Var)){
idx_NA_Var = c(idx_NA_Var, which(is.na(df[,idx_Var[i]])))
}
idx_NA_Var = sort(unique(idx_NA_Var))
Var_test = df[-idx_NA_Var,idx_Var]
Group_test = df[-idx_NA_Var,idx_Group]
x = Var_test[which(Group_test==groups[1]),]
y = Var_test[which(Group_test==groups[2]),]
# visualize and compute di correlation matrices
corr_matrix_x <- correlation_matrix(x)
corr_matrix_y <- correlation_matrix(y)
norm(corr_matrix_x)
norm(corr_matrix_y)
image(corr_matrix_x)
image(corr_matrix_y)
# test
iter = 1e3
matrix_x_obs <- correlation_matrix(x)
matrix_y_obs <- correlation_matrix(y)
T0 <- sqrt(sum((matrix_x_obs - matrix_y_obs)^2))
# T0 <- 1 - sum(diag(matrix_x_obs*matrix_y_obs))/(norm(matrix_x_obs,"F")*norm(matrix_y_obs,"F"))
x_pooled <- rbind(x,y)
T_stat <- numeric(iter)
n <- dim(x_pooled)[1]
n1 <- dim(x)[1]
for(perm in 1:iter){
# Permutation:
permutation <- sample(1:n)
x_pooled_perm <- x_pooled[permutation,]
x_perm <- x_pooled_perm[1:n1,]
y_perm <- x_pooled_perm[(n1+1):n,]
matrix_x_perm <- correlation_matrix(x_perm)
matrix_y_perm <- correlation_matrix(y_perm)
T_stat[perm] <- sqrt(sum((matrix_x_perm - matrix_y_perm)^2))
# T_stat[perm] <- 1 - sum(diag(matrix_x_perm*matrix_y_perm))/(norm(matrix_x_perm,"F")*norm(matrix_y_perm,"F"))
}
#pvalue
p_val <- sum(na.omit(T_stat)>=T0)/(iter-sum(is.na(T_stat)))
p_val
idx_Var = c(12,13,40,43,173)
idx_Group = 3
groups = levels(df[,idx_Group])
# discard NA
idx_NA_Var = c()
for (i in 1:length(idx_Var)){
idx_NA_Var = c(idx_NA_Var, which(is.na(df[,idx_Var[i]])))
}
idx_NA_Var = sort(unique(idx_NA_Var))
Var_test = df[-idx_NA_Var,idx_Var]
Group_test = df[-idx_NA_Var,idx_Group]
x = Var_test[which(Group_test==groups[1]),]
y = Var_test[which(Group_test==groups[2]),]
# visualize and compute di correlation matrices
corr_matrix_x <- correlation_matrix(x)
corr_matrix_y <- correlation_matrix(y)
norm(corr_matrix_x)
norm(corr_matrix_y)
image(corr_matrix_x)
image(corr_matrix_y)
# test
iter = 1e3
matrix_x_obs <- correlation_matrix(x)
matrix_y_obs <- correlation_matrix(y)
T0 <- sqrt(sum((matrix_x_obs - matrix_y_obs)^2))
# T0 <- 1 - sum(diag(matrix_x_obs*matrix_y_obs))/(norm(matrix_x_obs,"F")*norm(matrix_y_obs,"F"))
x_pooled <- rbind(x,y)
T_stat <- numeric(iter)
n <- dim(x_pooled)[1]
n1 <- dim(x)[1]
for(perm in 1:iter){
# Permutation:
permutation <- sample(1:n)
x_pooled_perm <- x_pooled[permutation,]
x_perm <- x_pooled_perm[1:n1,]
y_perm <- x_pooled_perm[(n1+1):n,]
matrix_x_perm <- correlation_matrix(x_perm)
matrix_y_perm <- correlation_matrix(y_perm)
T_stat[perm] <- sqrt(sum((matrix_x_perm - matrix_y_perm)^2))
# T_stat[perm] <- 1 - sum(diag(matrix_x_perm*matrix_y_perm))/(norm(matrix_x_perm,"F")*norm(matrix_y_perm,"F"))
}
#pvalue
p_val <- sum(na.omit(T_stat)>=T0)/(iter-sum(is.na(T_stat)))
p_val
idx_Var = c(12,13,48,50,173)
idx_Group = 3
groups = levels(df[,idx_Group])
# discard NA
idx_NA_Var = c()
for (i in 1:length(idx_Var)){
idx_NA_Var = c(idx_NA_Var, which(is.na(df[,idx_Var[i]])))
}
idx_NA_Var = sort(unique(idx_NA_Var))
Var_test = df[-idx_NA_Var,idx_Var]
Group_test = df[-idx_NA_Var,idx_Group]
x = Var_test[which(Group_test==groups[1]),]
y = Var_test[which(Group_test==groups[2]),]
# visualize and compute di correlation matrices
corr_matrix_x <- correlation_matrix(x)
corr_matrix_y <- correlation_matrix(y)
norm(corr_matrix_x)
norm(corr_matrix_y)
image(corr_matrix_x)
image(corr_matrix_y)
# test
iter = 1e3
matrix_x_obs <- correlation_matrix(x)
matrix_y_obs <- correlation_matrix(y)
T0 <- sqrt(sum((matrix_x_obs - matrix_y_obs)^2))
# T0 <- 1 - sum(diag(matrix_x_obs*matrix_y_obs))/(norm(matrix_x_obs,"F")*norm(matrix_y_obs,"F"))
x_pooled <- rbind(x,y)
T_stat <- numeric(iter)
n <- dim(x_pooled)[1]
n1 <- dim(x)[1]
for(perm in 1:iter){
# Permutation:
permutation <- sample(1:n)
x_pooled_perm <- x_pooled[permutation,]
x_perm <- x_pooled_perm[1:n1,]
y_perm <- x_pooled_perm[(n1+1):n,]
matrix_x_perm <- correlation_matrix(x_perm)
matrix_y_perm <- correlation_matrix(y_perm)
T_stat[perm] <- sqrt(sum((matrix_x_perm - matrix_y_perm)^2))
# T_stat[perm] <- 1 - sum(diag(matrix_x_perm*matrix_y_perm))/(norm(matrix_x_perm,"F")*norm(matrix_y_perm,"F"))
}
#pvalue
p_val <- sum(na.omit(T_stat)>=T0)/(iter-sum(is.na(T_stat)))
p_val
idx_Var = c(12,13,48,50,173,155)
idx_Group = 3
groups = levels(df[,idx_Group])
# discard NA
idx_NA_Var = c()
for (i in 1:length(idx_Var)){
idx_NA_Var = c(idx_NA_Var, which(is.na(df[,idx_Var[i]])))
}
idx_NA_Var = sort(unique(idx_NA_Var))
Var_test = df[-idx_NA_Var,idx_Var]
Group_test = df[-idx_NA_Var,idx_Group]
x = Var_test[which(Group_test==groups[1]),]
y = Var_test[which(Group_test==groups[2]),]
# visualize and compute di correlation matrices
corr_matrix_x <- correlation_matrix(x)
corr_matrix_y <- correlation_matrix(y)
norm(corr_matrix_x)
norm(corr_matrix_y)
image(corr_matrix_x)
image(corr_matrix_y)
# test
iter = 1e3
matrix_x_obs <- correlation_matrix(x)
matrix_y_obs <- correlation_matrix(y)
T0 <- sqrt(sum((matrix_x_obs - matrix_y_obs)^2))
# T0 <- 1 - sum(diag(matrix_x_obs*matrix_y_obs))/(norm(matrix_x_obs,"F")*norm(matrix_y_obs,"F"))
x_pooled <- rbind(x,y)
T_stat <- numeric(iter)
n <- dim(x_pooled)[1]
n1 <- dim(x)[1]
for(perm in 1:iter){
# Permutation:
permutation <- sample(1:n)
x_pooled_perm <- x_pooled[permutation,]
x_perm <- x_pooled_perm[1:n1,]
y_perm <- x_pooled_perm[(n1+1):n,]
matrix_x_perm <- correlation_matrix(x_perm)
matrix_y_perm <- correlation_matrix(y_perm)
T_stat[perm] <- sqrt(sum((matrix_x_perm - matrix_y_perm)^2))
# T_stat[perm] <- 1 - sum(diag(matrix_x_perm*matrix_y_perm))/(norm(matrix_x_perm,"F")*norm(matrix_y_perm,"F"))
}
#pvalue
p_val <- sum(na.omit(T_stat)>=T0)/(iter-sum(is.na(T_stat)))
p_val
idx_Var = 48
idx_Group = 70
groups = levels(df[,idx_Group])
# discard NA
idx_NA_Var = which(is.na(df[,idx_Var]))
idx_NA_Group = which(is.na(df[,idx_Group]))
if (length(idx_NA_Var)==0 & length(idx_NA_Group)==0){
Var_test = df[,idx_Var]
Group_test = df[,idx_Group]
x = Var_test[which(Group_test ==groups[1])]
y = Var_test[which(Group_test ==groups[2])]
}
if(length(idx_NA_Var)!=0 & length(idx_NA_Group)==0) {
Var_test = df[-idx_NA_Var,idx_Var]
Group_test = df[-idx_NA_Var,idx_Group]
x = Var_test[which(Group_test ==groups[1])]
y = Var_test[which(Group_test ==groups[2])]
}
if(length(idx_NA_Var)==0 & length(idx_NA_Group)!=0) {
Var_test = df[-idx_NA_Group,idx_Var]
Group_test = df[-idx_NA_Group,idx_Group]
x = Var_test[which(Group_test ==groups[1])]
y = Var_test[which(Group_test ==groups[2])]
}
if(length(idx_NA_Var)!=0 & length(idx_NA_Group)!=0) {
Var_test = df[-c(idx_NA_Var, idx_NA_Group),idx_Var]
Group_test = df[-c(idx_NA_Var, idx_NA_Group),idx_Group]
x = Var_test[which(Group_test ==groups[1])]
y = Var_test[which(Group_test ==groups[2])]
}
x11()
boxplot(x,main=groups[1])
x11()
boxplot(y,main=groups[2])
perm_t_test_mean(x,y)
perm_t_test_median(x,y)
perm_anova(Var_test, Group_test)
threshold = 240
x = x[which(x <= threshold)]
y = y[which(y <= threshold)]
x11()
boxplot(x,main=groups[1])
x11()
boxplot(y,main=groups[2])
perm_t_test_mean(x,y)
perm_t_test_median(x,y)
perm_anova(Var_test, Group_test)
idx_Var = 50
idx_Group = 70
groups = levels(df[,idx_Group])
# discard NA
idx_NA_Var = which(is.na(df[,idx_Var]))
idx_NA_Group = which(is.na(df[,idx_Group]))
if (length(idx_NA_Var)==0 & length(idx_NA_Group)==0){
Var_test = df[,idx_Var]
Group_test = df[,idx_Group]
x = Var_test[which(Group_test ==groups[1])]
y = Var_test[which(Group_test ==groups[2])]
}
if(length(idx_NA_Var)!=0 & length(idx_NA_Group)==0) {
Var_test = df[-idx_NA_Var,idx_Var]
Group_test = df[-idx_NA_Var,idx_Group]
x = Var_test[which(Group_test ==groups[1])]
y = Var_test[which(Group_test ==groups[2])]
}
if(length(idx_NA_Var)==0 & length(idx_NA_Group)!=0) {
Var_test = df[-idx_NA_Group,idx_Var]
Group_test = df[-idx_NA_Group,idx_Group]
x = Var_test[which(Group_test ==groups[1])]
y = Var_test[which(Group_test ==groups[2])]
}
if(length(idx_NA_Var)!=0 & length(idx_NA_Group)!=0) {
Var_test = df[-c(idx_NA_Var, idx_NA_Group),idx_Var]
Group_test = df[-c(idx_NA_Var, idx_NA_Group),idx_Group]
x = Var_test[which(Group_test ==groups[1])]
y = Var_test[which(Group_test ==groups[2])]
}
# Set threshold for numerical variable if wanted
threshold = 240
x = x[which(x <= threshold)]
y = y[which(y <= threshold)]
x11()
boxplot(x,main=groups[1])
x11()
boxplot(y,main=groups[2])
perm_t_test_mean(x,y)
perm_t_test_median(x,y)
perm_anova(Var_test, Group_test)
